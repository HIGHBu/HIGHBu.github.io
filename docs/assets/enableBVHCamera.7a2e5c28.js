import{y as P,z as V,A as f,G as _,H as i,I as m,J as v,K as S,X as h,Y as R,Z as T,$ as W,a0 as j}from"./index.d7926f49.js";import{g}from"./useBVHMap.ae050dd6.js";const p=new Set,[b,H]=P();V(function(){const e=g();if(!e.length){const t=f(b);return()=>{t.cancel()}}const o=f(()=>{b();for(const t of p){t.updateMatrixWorld();const c=t.getWorldDirection(_),{start:s,end:n}=m;n.copy(s.copy(t.position)),i.makeEmpty(),i.expandByPoint(s),i.min.addScalar(-.5),i.max.addScalar(.5);const y=v,C=S;let r=0,d=0;for(const B of e)B.shapecast({intersectsBounds:u=>u.intersectsBox(i),intersectsTriangle:u=>{r=u.closestPointToSegment(m,y,C),r<.5&&(d=.5-r,s.addScaledVector(c,d),n.addScaledVector(c,d))}});const l=s.sub(t.position),x=Math.max(0,l.length()-1e-5);l.normalize().multiplyScalar(x),t.position.add(l)}});return()=>{o.cancel()}},[g]);function M(e){var o;const{target:t}=this;t&&t._visible===void 0&&(t.outerObject3d.visible=e);for(const a of this.camera.children)((o=a.userData.manager)===null||o===void 0?void 0:o._visible)===void 0&&(a.visible=e)}function w(){if(this.done)return;const e=this.camera;h.attach(e),p.add(e),this.then(()=>{h.remove(e),p.delete(e)});let o=!1;this.watch(H(()=>{const t=this.outerObject3d.getWorldPosition(v),a=this.object3d.getWorldPosition(S),c=a.distanceTo(t);e.position.lerp(a,.1);const s=e.position.distanceTo(t)/c;e.position.lerpVectors(t,a,s),e.quaternion.copy(this.object3d.getWorldQuaternion(R));const n=T()&&W()===j?!1:s<.35;n!==o&&M.call(this,!n),o=n}))}export{w as default};
