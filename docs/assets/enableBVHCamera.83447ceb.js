import{_ as V,$ as _,a0 as f,a1 as C,a2 as i,a3 as h,a4 as v,a5 as S,a6 as m,a7 as R,a8 as T}from"./index.66496b60.js";import{g as b}from"./useBVHMap.e7ab579a.js";const p=new Set,[g,W]=V();_(function(){const e=b();if(!e.length){const t=f(g);return()=>{t.cancel()}}const o=f(()=>{g();for(const t of p){t.updateMatrixWorld();const c=t.getWorldDirection(C),{start:s,end:n}=h;n.copy(s.copy(t.position)),i.makeEmpty(),i.expandByPoint(s),i.min.addScalar(-.5),i.max.addScalar(.5);const x=v,y=S;let r=0,d=0;for(const P of e)P.shapecast({intersectsBounds:u=>u.intersectsBox(i),intersectsTriangle:u=>{r=u.closestPointToSegment(h,x,y),r<.5&&(d=.5-r,s.addScaledVector(c,d),n.addScaledVector(c,d))}});const l=s.sub(t.position),B=Math.max(0,l.length()-1e-5);l.normalize().multiplyScalar(B),t.position.add(l)}});return()=>{o.cancel()}},[b]);function j(e){var o;const{target:t}=this;t&&t._visible===void 0&&(t.outerObject3d.visible=e);for(const a of this.camera.children)((o=a.userData.manager)===null||o===void 0?void 0:o._visible)===void 0&&(a.visible=e)}function O(){if(this.done)return;const e=this.camera;m.attach(e),p.add(e),this.then(()=>{m.remove(e),p.delete(e)});let o=!1;this.watch(W(()=>{const t=this.outerObject3d.getWorldPosition(v),a=this.object3d.getWorldPosition(S),c=a.distanceTo(t);e.position.lerp(a,.1);const s=e.position.distanceTo(t)/c;e.position.lerpVectors(t,a,s),e.quaternion.copy(this.object3d.getWorldQuaternion(R));const n=T()?!1:s<.35;n!==o&&j.call(this,!n),o=n}))}export{O as default};
